# 检测端文档

## 系统概述

本系统是一个基于计算机视觉的人数检测系统，可连接多个摄像头，检测画面中的人数并将结果上传至云服务器。系统支持两种工作模式，适用于不同的应用场景。

## 功能特点

- **多摄像头支持**：可同时连接并管理多个摄像头
- **双工作模式**：支持主动拉取和被动接收两种模式
- **实时检测**：快速分析图像中的人数
- **数据上传**：自动将检测结果上传至云端服务器
- **稳定性保障**：异常处理和错误日志记录

## 系统架构

系统由以下几个主要组件构成：
- 图像获取模块：负责从摄像头获取图像
- 人数检测模块：使用深度学习模型检测图像中的人数
- 数据上传模块：将检测结果发送至指定服务器
- API服务器：在被动模式下接收图像请求

## 工作模式

### 1. 主动拉取模式 (Pull)

在此模式下，系统会定期主动从配置的摄像头获取图像，进行分析后上传结果。

- **优点**：无需外部触发，定时执行
- **适用场景**：固定位置的监控摄像头，需要定期检测的场所

### 2. 被动接收模式 (Push)

在此模式下，系统作为服务器等待客户端发送图像，收到后进行分析并返回结果。

- **优点**：按需处理，节省资源
- **适用场景**：移动设备或不需要连续监控的场所

## 配置说明

### 摄像头配置

在`main.py`中通过`CAMERAS`字典配置摄像头：

```python
CAMERAS = {
    1: "rtsp://username:password@192.168.1.101:554/stream",
    2: "rtsp://username:password@192.168.1.102:554/stream"
}
```

### 工作模式设置

通过修改`MODE`变量切换工作模式：

```python
MODE = "push"  # "pull" 或 "push"
```

## 安装与部署

### 前置条件

- Python 3.6+
- OpenCV
- Flask
- 必要的深度学习库

### 安装步骤

1. 克隆代码库
   ```
   git clone [repository-url]
   ```

2. 安装依赖
   ```
   pip install -r requirements.txt
   ```

3. 配置摄像头参数和工作模式

4. 运行系统
   ```
   python main.py
   ```

## API 接口

### 被动模式接口

- **URL**: `/api/push_frame/<camera_id>`
- **方法**: POST
- **参数**: 
  - `camera_id`: 摄像头ID (整数)
  - `file`: 图像文件 (multipart/form-data)
- **返回**: 
  ```json
  {
    "status": "success",
    "camera_id": 1,
    "count": 5
  }
  ```

## 常见问题

### Q: 系统无法连接摄像头
A: 请检查摄像头URL格式是否正确，以及网络连接是否稳定。

### Q: 检测结果未上传成功
A: 确认上传服务器地址正确且可访问，查看网络连接状态。

### Q: 如何添加新的摄像头
A: 在`CAMERAS`字典中添加新的键值对，键为摄像头ID，值为RTSP地址。

## 开发与扩展

系统设计为模块化结构，您可以通过以下方式扩展功能：
- 修改检测算法以支持更多物体类型
- 添加本地存储模块保存历史数据
- 集成其他视觉分析功能

## 许可证

[许可证信息]

## 联系方式

如有任何问题或建议，请联系[联系方式]
